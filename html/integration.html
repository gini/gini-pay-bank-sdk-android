

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Integration &mdash; Gini Capture SDK for Android 2.0 documentation</title>
  

  
  

  
  <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,400italic,600italic|Source+Code+Pro|Roboto+Slab:400,700" rel="stylesheet" type="text/css" />

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'2.0',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
    <script type="text/javascript">
        jQuery(function () {
            SphinxRtdTheme.StickyNav.enable();
        });
    </script>
  

  
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Gini Capture SDK for Android 2.0 documentation" href="index.html"/>
        <link rel="next" title="Invoice Capture Features" href="capture-features.html"/>
        <link rel="prev" title="Getting started" href="getting-started.html"/> 

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" id="gini-logo">
          <img src="_static/logo.svg" />
        </a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#installation">Installation</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#capturing-invoices">Capturing Invoices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#android-manifest">Android Manifest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirements-check">Requirements Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tablet-support">Tablet Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#networking">Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#capture-flow">Capture Flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#handling-payment-requests">Handling Payment Requests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Android Manifest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-name">Package Name</a></li>
<li class="toctree-l3"><a class="reference internal" href="#receive-payment-requests">Receive Payment Requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="capture-features.html">Invoice Capture Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="capture-features.html#features-from-the-gini-capture-sdk">Features from the Gini Capture SDK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="capture-features.html#file-import-open-with">File Import (Open With)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="capture-features.html#return-assistant">Return Assistant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="capture-features.html#id1">Screen API</a></li>
<li class="toctree-l3"><a class="reference internal" href="capture-features.html#id3">Component API</a></li>
<li class="toctree-l3"><a class="reference internal" href="capture-features.html#sending-feedback">Sending Feedback</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="customization.html">Customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrating-from-gvl.html">Migrating from the Gini Vision Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#kotlin">Kotlin</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#gini-capture-sdk">Gini Capture SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#gini-pay-api-library">Gini Pay API Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#screen-api">Screen API</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#component-api">Component API</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#open-with">Open With</a><ul>
<li class="toctree-l3"><a class="reference internal" href="migrating-from-gvl.html#id3">Screen API</a></li>
<li class="toctree-l3"><a class="reference internal" href="migrating-from-gvl.html#id4">Component API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#networking">Networking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="migrating-from-gvl.html#default">Default</a></li>
<li class="toctree-l3"><a class="reference internal" href="migrating-from-gvl.html#custom">Custom</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#event-tracking">Event Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-gvl.html#customization">Customization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference Doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Gini Capture SDK for Android</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Integration</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="integration">
<h1>Integration<a class="headerlink" href="#integration" title="Permalink to this headline">¶</a></h1>
<p>The Gini Pay Bank SDK has two main features: <a class="reference internal" href="#capturing-invoices">capturing invoices</a> for information extraction and <a class="reference internal" href="#handling-payment-requests">handling payment requests</a>. Both
can be used independently and you may opt to use only one or both in your app.</p>
<div class="section" id="capturing-invoices">
<h2>Capturing Invoices<a class="headerlink" href="#capturing-invoices" title="Permalink to this headline">¶</a></h2>
<p>The capture feature uses our <a class="reference external" href="https://github.com/gini/gini-capture-sdk-android/">Gini Capture SDK</a> to provide
Activities and Fragments to capture invoices and prepare them for upload to the Gini Pay API. It also allows documents
to be imported from other apps. The captured images can be reviewed and are optimized on the device to provide the best
results when used with the Gini Pay API.</p>
<div class="section" id="android-manifest">
<h3>Android Manifest<a class="headerlink" href="#android-manifest" title="Permalink to this headline">¶</a></h3>
<p>The capture feature of the SDK uses the camera therefore the camera permission is required:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">package=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.CAMERA&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure you request the camera permission before starting the SDK.</p>
</div>
</div>
<div class="section" id="requirements-check">
<h3>Requirements Check<a class="headerlink" href="#requirements-check" title="Permalink to this headline">¶</a></h3>
<p>We recommend running our runtime requirements check first before launching the Gini Capture SDK to ensure the device is
capable of taking pictures of adequate quality.</p>
<p>Simply run <code class="docutils literal notranslate"><span class="pre">GiniPayBank.checkCaptureRequirements()</span></code> and inspect the returned <code class="docutils literal notranslate"><span class="pre">RequirementsReport</span></code> for the result:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On Android 6.0 and later the camera permission is required before checking the requirements.</p>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span> <span class="n">RequirementsReport</span> <span class="n">report</span> <span class="o">=</span> <span class="n">GiniPayBank</span><span class="p">.</span><span class="na">checkCaptureRequirements</span><span class="p">((</span><span class="n">Context</span><span class="p">)</span> <span class="k">this</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">report</span><span class="p">.</span><span class="na">isFulfilled</span><span class="p">())</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">StringBuilder</span> <span class="n">stringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
    <span class="n">report</span><span class="p">.</span><span class="na">getRequirementReports</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">requirementReport</span> <span class="o">-&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">requirementReport</span><span class="p">.</span><span class="na">isFulfilled</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">stringBuilder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">requirementReport</span><span class="p">.</span><span class="na">getRequirementId</span><span class="p">());</span>
            <span class="n">stringBuilder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;: &quot;</span><span class="p">);</span>
            <span class="n">stringBuilder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">requirementReport</span><span class="p">.</span><span class="na">getDetails</span><span class="p">());</span>
            <span class="n">stringBuilder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s">&quot;Requirements not fulfilled:\n&quot;</span> <span class="o">+</span> <span class="n">stringBuilder</span><span class="p">,</span>
            <span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_LONG</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>Configuration and interaction is done using <code class="docutils literal notranslate"><span class="pre">CaptureConfiguration</span></code>. To set the configuration use the
<code class="docutils literal notranslate"><span class="pre">GiniPayBank.setCaptureConfiguration()</span></code> static method.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The configuration is immutable and make sure to call <code class="docutils literal notranslate"><span class="pre">GiniPayBank.releaseCapture()</span></code> before setting a new
configuration.</p>
</div>
<p>You should call <code class="docutils literal notranslate"><span class="pre">GiniPayBank.releaseCapture()</span></code> after the SDK returned control to your application and your app has
sent feedback to the Gini Pay API and is not using the capture feature anymore.</p>
<p>To view all the configuration options see the documentation of <a class="reference external" href="http://developer.gini.net/gini-pay-bank-sdk-android/kdoc/ginipaybank/net.gini.pay.bank.capture/-capture-configuration/index.html">CaptureConfiguration</a>.</p>
<p>Information about the configurable features are available on the <a class="reference external" href="capture-features.html">Capture Features</a> page.</p>
</div>
<div class="section" id="tablet-support">
<h3>Tablet Support<a class="headerlink" href="#tablet-support" title="Permalink to this headline">¶</a></h3>
<p>The Gini Pay Bank SDK can be used on tablets, too. Some UI elements adapt to the larger screen to offer the best user
experience for tablet users.</p>
<p>Many tablets with at least 8MP cameras don’t have an LED flash. Therefore we don’t require flash for tablets. For this
reason the extraction quality on those tablets might be lower compared to smartphones.</p>
<p>On tablets landscape orientation is also supported (smartphones are portrait only). We advise you to test your
integration on tablets in both orientations.</p>
<p>In landscape the camera screen’s UI displays the camera trigger button on the right side of the screen. Users
can reach the camera trigger more easily this way. The camera preview along with the document corner guides are shown in
landscape to match the device’s orientation.</p>
<p>Other UI elements on all the screens maintain their relative position and the screen layouts are scaled automatically to
fit the current orientation.</p>
</div>
<div class="section" id="networking">
<h3>Networking<a class="headerlink" href="#networking" title="Permalink to this headline">¶</a></h3>
<p>The Gini Pay Bank SDK allows you to use the default networking implementation of our Gini Capture SDK to communicate with the Gini
Pay API. You may also implement your own networking layer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should have received Gini Pay API client credentials from us. Please get in touch with us in case you don’t have
them. Without credentials you won’t be able to use the Gini Pay API.</p>
</div>
<div class="section" id="default-implementation">
<h4>Default Implementation<a class="headerlink" href="#default-implementation" title="Permalink to this headline">¶</a></h4>
<p>The capture feature is not aware of any networking implementations and requires you to set them in the
<code class="docutils literal notranslate"><span class="pre">CaptureConfiguration</span></code>.</p>
<p>The default networking implementations are the <code class="docutils literal notranslate"><span class="pre">GiniCaptureDefaultNetworkService</span></code> and
<code class="docutils literal notranslate"><span class="pre">GiniCaptureDefaultNetworkApi</span></code>. We provide you with two helper methods to create them with the minimal configuration:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">networkService</span> <span class="o">=</span> <span class="n">getDefaultNetworkService</span><span class="p">(</span>
    <span class="n">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
    <span class="n">clientId</span> <span class="o">=</span> <span class="n">myClientId</span><span class="p">,</span>
    <span class="n">clientSecret</span> <span class="o">=</span> <span class="n">myClientSecret</span><span class="p">,</span>
    <span class="n">emailDomain</span> <span class="o">=</span> <span class="n">myEmailDomain</span><span class="p">,</span>
    <span class="n">documentMetadata</span> <span class="o">=</span> <span class="n">myDocumentMetadata</span>
<span class="p">)</span>

<span class="n">val</span> <span class="n">networkApi</span> <span class="o">=</span> <span class="n">getDefaultNetworkApi</span><span class="p">(</span><span class="n">networkService</span><span class="p">)</span>

<span class="n">GiniPayBank</span><span class="p">.</span><span class="na">setCaptureConfiguration</span><span class="p">(</span>
    <span class="n">CaptureConfiguration</span><span class="p">(</span>
        <span class="n">networkService</span> <span class="o">=</span> <span class="n">networkService</span><span class="p">,</span>
        <span class="n">networkApi</span> <span class="o">=</span> <span class="n">networkApi</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For all configuration options of the default networking implementation see the documentation of
<a class="reference external" href="http://developer.gini.net/gini-capture-sdk-android/network/javadoc/net/gini/android/capture/network/GiniCaptureDefaultNetworkService.Builder.html">GiniCaptureDefaultNetworkService.Builder</a>
and <a class="reference external" href="http://developer.gini.net/gini-capture-sdk-android/network/javadoc/net/gini/android/capture/network/GiniCaptureDefaultNetworkApi.Builder.html">GiniCaptureDefaultNetworkApi.Builder</a>.</p>
</div>
<div class="section" id="custom-implementation">
<h4>Custom Implementation<a class="headerlink" href="#custom-implementation" title="Permalink to this headline">¶</a></h4>
<p>You can also provide your own networking by implementing the <code class="docutils literal notranslate"><span class="pre">GiniCaptureNetworkService</span></code> and the
<code class="docutils literal notranslate"><span class="pre">GiniCaptureNetworkApi</span></code> interfaces:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GiniCaptureNetworkService</span></code></dt>
<dd>This interface is used to upload, analyze and delete documents. See the <a class="reference external" href="http://developer.gini.net/gini-capture-sdk-android/ginicapture/dokka/ginicapture/net.gini.android.capture.network/-gini-capture-network-service/index.html">reference documentation</a>
for details.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GiniCaptureNetworkApi</span></code></dt>
<dd>This interface is used to declare network tasks which should be called by you outside of the Gini Capture SDK (e.g.,
for sending feedback after the user saw and potentielly corrected the extractions).  See the <a class="reference external" href="http://developer.gini.net/gini-capture-sdk-android/ginicapture/dokka/ginicapture/net.gini.android.capture.network/-gini-capture-network-api/index.html">reference documentation</a>
for details.</dd>
</dl>
</li>
</ul>
<p>You may also use the <a class="reference external" href="https://github.com/gini/gini-pay-api-lib-android">Gini Pay API Library</a> for Android or implement
communication with the Gini API yourself.</p>
</div>
<div class="section" id="sending-feedback">
<h4>Sending Feedback<a class="headerlink" href="#sending-feedback" title="Permalink to this headline">¶</a></h4>
<p>Your app should send feedback for the extractions the Gini Pay API delivered. Feedback should be sent <em>only</em> for the
extractions the user has seen and accepted (or corrected).</p>
<p>For addition information about feedback see the <a class="reference external" href="https://pay-api.gini.net/documentation/#send-feedback-and-get-even-better-extractions-next-time">Gini Pay API documentation</a>.</p>
<div class="section" id="id2">
<h5>Default Implementation<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<p>The example below shows how to correct extractions and send feedback using the default networking implementation:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">networkApi</span><span class="p">:</span> <span class="n">GiniCaptureDefaultNetworkApi</span> <span class="c1">// Provided</span>

<span class="n">val</span> <span class="n">extractions</span><span class="p">:</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">GiniCaptureSpecificExtraction</span><span class="o">&gt;</span> <span class="c1">// Provided</span>

<span class="c1">// Modify the amount to pay extraction&#39;s value.</span>
<span class="n">GiniCaptureSpecificExtraction</span> <span class="n">amountToPay</span> <span class="o">=</span> <span class="n">extractions</span><span class="o">[</span><span class="s">&quot;amountToPay&quot;</span><span class="o">]</span><span class="p">;</span>
<span class="n">amountToPay</span><span class="p">.</span><span class="na">value</span> <span class="o">=</span> <span class="s">&quot;31.00:EUR&quot;</span>

<span class="c1">// You should send feedback only for extractions the user has seen and accepted.</span>
<span class="c1">// In this example only the amountToPay was wrong and we can reuse the other extractions.</span>
 <span class="n">val</span> <span class="n">feedback</span> <span class="o">=</span> <span class="n">mapOf</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">GiniCaptureSpecificExtraction</span><span class="o">&gt;</span><span class="p">(</span>
     <span class="s">&quot;iban&quot;</span> <span class="n">to</span> <span class="n">mExtractions</span><span class="o">[</span><span class="s">&quot;iban&quot;</span><span class="o">]</span><span class="p">,</span>
     <span class="s">&quot;amountToPay&quot;</span> <span class="n">to</span> <span class="n">amountTopay</span><span class="p">,</span>
     <span class="s">&quot;bic&quot;</span> <span class="n">to</span> <span class="n">mExtractions</span><span class="o">[</span><span class="s">&quot;bic&quot;</span><span class="o">]</span><span class="p">,</span>
     <span class="s">&quot;senderName&quot;</span> <span class="n">to</span> <span class="n">mExtractions</span><span class="o">[</span><span class="s">&quot;sencerName&quot;</span><span class="o">]</span>
 <span class="p">)</span>

 <span class="n">networkApi</span><span class="p">.</span><span class="na">sendFeedback</span><span class="p">(</span><span class="n">feedback</span><span class="p">,</span> <span class="n">object</span> <span class="p">:</span> <span class="n">GiniCaptureNetworkCallback</span><span class="o">&lt;</span><span class="n">Void</span><span class="p">,</span> <span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="n">override</span> <span class="n">fun</span> <span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="n">Error</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// Handle the error.</span>
     <span class="p">}</span>

     <span class="n">override</span> <span class="n">fun</span> <span class="nf">success</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">Void</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// Feedback sent successfully.</span>
     <span class="p">}</span>

     <span class="n">override</span> <span class="n">fun</span> <span class="nf">cancelled</span><span class="p">()</span> <span class="p">{</span>
         <span class="c1">// Handle cancellation.</span>
     <span class="p">}</span>
 <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Custom Implementation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<p>If you use your own networking implementation and directly communicate with the Gini Pay API then see <a class="reference external" href="https://pay-api.gini.net/documentation/#submitting-feedback-on-extractions">this section</a> in its documentation on how to send
feedback.</p>
<p>In case you use the Gini Pay API Library then see <a class="reference external" href="https://developer.gini.net/gini-pay-api-lib-android/guides/common-tasks.html#sending-feedback">this section</a> in its documentation
for details.</p>
</div>
</div>
</div>
<div class="section" id="capture-flow">
<h3>Capture Flow<a class="headerlink" href="#capture-flow" title="Permalink to this headline">¶</a></h3>
<p>The capture flow can be used in two ways, either by using the <a class="reference internal" href="#screen-api">Screen API</a> or the <a class="reference internal" href="#component-api">Component API</a>:</p>
<ul class="simple">
<li>The <em>Screen API</em> provides activities for easy integration that can be customized in a
limited way. The screen and configuration design is based on our long-lasting experience with
integration in customer apps.</li>
<li>In the <em>Component API</em> we provide fragments for advanced integration
with more freedom for customization.</li>
</ul>
<div class="section" id="screen-api">
<h4>Screen API<a class="headerlink" href="#screen-api" title="Permalink to this headline">¶</a></h4>
<p>This is the easiest way to use the capture flow. You only need to:</p>
<ol class="arabic simple">
<li>Request camera access,</li>
<li>Configure the capture feature using the <code class="docutils literal notranslate"><span class="pre">CaptureConfiguration</span></code>,</li>
<li>Register an activity result handler with the <code class="docutils literal notranslate"><span class="pre">CaptureFlowContract()</span></code>,</li>
<li>Start the capture flow.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Check out the <a class="reference external" href="https://github.com/gini/gini-pay-bank-sdk-android/tree/main/appscreenapi">Screen API example app</a> to see how an integration could look
like.</p>
</div>
<p>The following example shows how to launch the capture flow using the <em>Screen API</em> and how to handle the results:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use the androidx&#39;s Activity Result API to register a handler for the capture result.</span>
<span class="n">val</span> <span class="n">captureLauncher</span> <span class="o">=</span> <span class="n">registerForActivityResult</span><span class="p">(</span><span class="n">CaptureFlowContract</span><span class="p">())</span> <span class="p">{</span> <span class="n">result</span><span class="p">:</span> <span class="n">CaptureResult</span> <span class="o">-&gt;</span>
    <span class="n">when</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">is</span> <span class="n">CaptureResult</span><span class="p">.</span><span class="na">Success</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="n">handleExtractions</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">specificExtractions</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">is</span> <span class="n">CaptureResult</span><span class="p">.</span><span class="na">Error</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="n">when</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">is</span> <span class="n">ResultError</span><span class="p">.</span><span class="na">Capture</span> <span class="o">-&gt;</span> <span class="p">{</span>
                    <span class="n">val</span> <span class="n">captureError</span><span class="p">:</span> <span class="n">GiniCaptureError</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">value</span> <span class="n">as</span> <span class="n">ResultError</span><span class="p">.</span><span class="na">Capture</span><span class="p">).</span><span class="na">giniCaptureError</span>
                    <span class="n">handleCaptureError</span><span class="p">(</span><span class="n">captureError</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">is</span> <span class="n">ResultError</span><span class="p">.</span><span class="na">FileImport</span> <span class="o">-&gt;</span> <span class="p">{</span>
                    <span class="c1">// See the File Import section on the Capture Features page for more details.</span>
                    <span class="n">val</span> <span class="n">fileImportError</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="na">value</span> <span class="n">as</span> <span class="n">ResultError</span><span class="p">.</span><span class="na">FileImport</span>
                    <span class="nf">handleFileImportError</span><span class="p">(</span><span class="n">fileImportError</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">CaptureResult</span><span class="p">.</span><span class="na">Empty</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="n">handleNoExtractions</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">CaptureResult</span><span class="p">.</span><span class="na">Cancel</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="n">handleCancellation</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">fun</span> <span class="nf">launchGiniCapture</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Make sure camera permission has been already granted at this point.</span>

    <span class="c1">// Check that the device fulfills the requirements.</span>
    <span class="n">val</span> <span class="n">report</span> <span class="o">=</span> <span class="n">GiniCaptureRequirements</span><span class="p">.</span><span class="na">checkRequirements</span><span class="p">((</span><span class="n">Context</span><span class="p">)</span> <span class="k">this</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">report</span><span class="p">.</span><span class="na">isFulfilled</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">handleUnfulfilledRequirements</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// Instantiate the networking implementations.</span>
    <span class="n">val</span> <span class="n">networkService</span><span class="p">:</span> <span class="n">GiniCaptureNetworkService</span>  <span class="o">=</span> <span class="p">...</span>
    <span class="n">val</span> <span class="n">networkApi</span><span class="p">:</span> <span class="n">GiniCaptureNetworkApi</span> <span class="o">=</span> <span class="p">...</span>

    <span class="c1">// Cleanup to make sure everything is reset.</span>
    <span class="n">GiniPayBank</span><span class="p">.</span><span class="na">releaseCapture</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

    <span class="c1">// Configure the capture feature.</span>
    <span class="n">GiniPayBank</span><span class="p">.</span><span class="na">setCaptureConfiguration</span><span class="p">(</span>
        <span class="n">CaptureConfiguration</span><span class="p">(</span>
            <span class="n">networkService</span> <span class="o">=</span> <span class="n">networkService</span><span class="p">,</span>
            <span class="n">networkApi</span> <span class="o">=</span> <span class="n">networkApi</span><span class="p">,</span>
            <span class="p">...</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1">// Launch and wait for the result.</span>
    <span class="n">GiniPayBank</span><span class="p">.</span><span class="na">startCaptureFlow</span><span class="p">(</span><span class="n">captureLauncher</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="component-api">
<h4>Component API<a class="headerlink" href="#component-api" title="Permalink to this headline">¶</a></h4>
<p>This is the more complicated way of using the capture flow. The advantage is that it is based on fragments and you
have full control over how these are shown in your UI.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Check out the <a class="reference external" href="https://github.com/gini/gini-pay-bank-sdk-android/tree/main/appcomponentapi">Component API example app</a> to see how an integration could look
like.</p>
</div>
<p>Before launching the first fragment you need to:</p>
<ol class="arabic simple">
<li>Request camera access,</li>
<li>Configure the capture feature using the <code class="docutils literal notranslate"><span class="pre">CaptureConfiguration</span></code>.</li>
</ol>
<p>The Component API is exposed as-is from the Gini Capture SDK and you can follow <a class="reference external" href="https://developer.gini.net/gini-capture-sdk-android/html/integration.html#component-api">it’s guide</a> to learn how to integrate
it.</p>
</div>
</div>
</div>
<div class="section" id="handling-payment-requests">
<h2>Handling Payment Requests<a class="headerlink" href="#handling-payment-requests" title="Permalink to this headline">¶</a></h2>
<p>The Gini Pay Bank SDK enables your app to handle payment requests started by the Gini Pay Business SDK in another app.
You can retrieve the payment requests’s content, mark the payment request as payed and also return your user to the app
that created the payment request.</p>
<div class="section" id="id5">
<h3>Networking<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The pay feature depends on the <a class="reference external" href="https://github.com/gini/gini-pay-api-lib-android">Gini Pay API Library</a>, which
provides an entry point through the <code class="docutils literal notranslate"><span class="pre">Gini</span></code> class.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should have received Gini Pay API client credentials from us. Please get in touch with us in case you don’t have
them. Without credentials you won’t be able to use the Gini Pay API.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Gini</span></code> class can be built either with client credentials or with a <code class="docutils literal notranslate"><span class="pre">SessionManager</span></code> if you already have an
authorization token. We provide helper methods for each case:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">getGiniApi</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span> <span class="n">clientId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">clientSecret</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
           <span class="n">emailDomain</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">getGiniApi</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span> <span class="n">sessionManager</span><span class="p">:</span> <span class="n">SessionManager</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SessionManager</span></code> is an interface which you need to implement to send the token.</p>
<p>For more details about the <code class="docutils literal notranslate"><span class="pre">Gini</span></code> class see the Gini Pay API Library’s <a class="reference external" href="https://developer.gini.net/gini-pay-api-lib-android/guides/getting-started.html#creating-the-gini-instance">documentation</a>.</p>
<p>Once you have a <code class="docutils literal notranslate"><span class="pre">Gini</span></code> instance you need to pass it to <code class="docutils literal notranslate"><span class="pre">GiniPayBank.setGiniApi()</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">giniApi</span> <span class="o">=</span> <span class="n">getGiniApi</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">myClientId</span><span class="p">,</span> <span class="n">myClientSecret</span><span class="p">,</span> <span class="n">myEmailDomain</span><span class="p">)</span>

<span class="n">GiniPayBank</span><span class="p">.</span><span class="na">setGiniApi</span><span class="p">(</span><span class="n">giniApi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>Android Manifest<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>To be able to receive payment requests you need to add an intent filter for the ginipay URI to your manifest. This also
allows the Gini Pay Business SDK to detect if your app is installed:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;intent-filter&gt;</span>
    <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.VIEW&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;data</span>
        <span class="na">android:host=</span><span class="s">&quot;payment&quot;</span>
        <span class="na">android:scheme=</span><span class="s">&quot;ginipay&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/intent-filter&gt;</span>
</pre></div>
</div>
<p>The intent filter can be added to the activity which will handle the payment flow of that payment request.</p>
</div>
<div class="section" id="package-name">
<h3>Package Name<a class="headerlink" href="#package-name" title="Permalink to this headline">¶</a></h3>
<p>You also need to tell us your app’s package name. It will be associated with the payment provider we
create for your banking app in the Gini Pay API. The Gini Pay Business SDK will only open your banking app if
it is installed and it has the same package name as the one known by the Gini Pay API.</p>
<p>If you have different package names for development and production
then please share both of them with us so that we can use the right one for each environment.</p>
</div>
<div class="section" id="receive-payment-requests">
<h3>Receive Payment Requests<a class="headerlink" href="#receive-payment-requests" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can see an example implementation in the Screen API example app’s <a class="reference external" href="https://github.com/gini/gini-pay-bank-sdk-android/tree/main/appscreenapi/src/main/java/net/gini/pay/appscreenapi/pay">pay</a>
package.</p>
</div>
<p>When your activity is launched with an intent you should follow the steps below to receive and handle the payment
request:</p>
<ol class="arabic">
<li><p class="first">Extract the payment request id from the intent with <code class="docutils literal notranslate"><span class="pre">getRequestId()</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">requestId</span> <span class="o">=</span> <span class="n">getRequestId</span><span class="p">(</span><span class="n">intent</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Retrieve the payment details set by the business app using <code class="docutils literal notranslate"><span class="pre">GiniPayBank.getPaymentRequest()</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">paymentRequest</span><span class="p">:</span> <span class="n">PaymentRequest</span> <span class="o">=</span> <span class="n">giniPayBank</span><span class="p">.</span><span class="na">getPaymentRequest</span><span class="p">(</span><span class="n">requestId</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Show the payment details to your user:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">showPaymentDetails</span><span class="p">(</span>
    <span class="n">paymentRequest</span><span class="p">.</span><span class="na">recipient</span><span class="p">,</span>
    <span class="n">paymentRequest</span><span class="p">.</span><span class="na">iban</span><span class="p">,</span>
    <span class="n">paymentRequest</span><span class="p">.</span><span class="na">bic</span><span class="p">,</span>
    <span class="n">paymentRequest</span><span class="p">.</span><span class="na">amount</span><span class="p">,</span>
    <span class="n">paymentRequest</span><span class="p">.</span><span class="na">purpose</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">After your user has initiated the payment mark the payment request as paid using
<code class="docutils literal notranslate"><span class="pre">GiniPayBank.resolvePaymentRequest()</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// The actual payment details used for the payment (as corrected and accepted by the user).</span>
<span class="n">val</span> <span class="n">usedPaymentDetails</span> <span class="o">=</span> <span class="n">ResolvePaymentInput</span><span class="p">(</span>
    <span class="n">recipient</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span><span class="p">,</span>
    <span class="n">iban</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span><span class="p">,</span>
    <span class="n">bic</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span><span class="p">,</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span><span class="p">,</span>
    <span class="n">purpose</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span>
<span class="p">)</span>

<span class="n">val</span> <span class="n">resolvedPayment</span><span class="p">:</span> <span class="n">ResolvedPayment</span> <span class="o">=</span> <span class="n">giniPayBank</span><span class="p">.</span><span class="na">resolvePaymentRequest</span><span class="p">(</span><span class="n">requestId</span><span class="p">,</span> <span class="n">usedPaymentDetails</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">You can allow your user to return to the business app that started the flow using <code class="docutils literal notranslate"><span class="pre">GiniPayBank.returnToBusiness()</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">giniPayBank</span><span class="p">.</span><span class="na">returnToBusiness</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">resolvedPayment</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p>Testing the payment feature requires an app which uses the Gini Pay Business SDK to create payment requests and to
forward them to your banking app to view and resolve those payment requests.</p>
<div class="section" id="requirements">
<h4>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<div class="section" id="example-business-app">
<h5>Example business app<a class="headerlink" href="#example-business-app" title="Permalink to this headline">¶</a></h5>
<p>An example business app is available in the <a class="reference external" href="https://github.com/gini/gini-pay-business-sdk-android">Gini Pay Business SDK’s</a>
repository.</p>
<p>You can use the same Gini Pay API client credentials in the example business app as in your app, if not otherwise
specified.</p>
<div class="section" id="development-gini-pay-api-client-credentials">
<h6>Development Gini Pay API client credentials<a class="headerlink" href="#development-gini-pay-api-client-credentials" title="Permalink to this headline">¶</a></h6>
<p>In order to test using our example business app you need to use development client credentials. This will make sure
the Gini Pay Business SDK will use a payment provider which will open your development banking app.</p>
</div>
</div>
</div>
<div class="section" id="end-to-end-testing">
<h4>End to end testing<a class="headerlink" href="#end-to-end-testing" title="Permalink to this headline">¶</a></h4>
<p>After you’ve set the client credentials in the example business app you can install it along with your banking app on
your device.</p>
<p>Run the example business app and import an invoice or take a picture of one to start the payment flow.</p>
<p>After following the integration steps above your banking app will be launched and you’ll be able to fetch the payment
request, show the payment information and resolve the payment after the transaction has been confirmed. At this point,
you may redirect back to the business app.</p>
<p>With these steps completed you have verified that your app, the Gini Pay API, the Gini Pay Business SDK and the Gini Pay
Bank SDK work together correctly.</p>
</div>
<div class="section" id="testing-in-production">
<h4>Testing in production<a class="headerlink" href="#testing-in-production" title="Permalink to this headline">¶</a></h4>
<p>The steps are the same but instead of the development client credentials you will need to use production client
credentials. This will make sure the Gini Pay Business SDK receives real payment providers including the one which
opens your production banking app.</p>
<p>For testing the flow using the example business app please make sure that the production client credentials are used
before installing it.</p>
<p>You can also test with a real business app. Please contact us in case you don’t know which business app(s) to install
for starting the payment flow.</p>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="capture-features.html" class="btn btn-neutral float-right" title="Invoice Capture Features">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getting-started.html" class="btn btn-neutral" title="Getting started"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>
</footer>
        </div>
      </div>

    </section>

  </div>
  

  
</body>
</html>